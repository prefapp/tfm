# **GitHub Repository Secrets Terraform Module**

## Overview

This module manages GitHub repository secrets for **Actions**, **Codespaces**, and **Dependabot** using a single strongly-typed `config` object.

**Important**:  
The `encryptedValue` values passed in the `config` **must already be encrypted** using **libsodium** against the target repository’s public key (GitHub’s recommended method).  
**Terraform does not perform any encryption**. It simply forwards the pre-encrypted value to the GitHub API.

This approach is the most secure for automated pipelines (Prefapp IDP, GitHub Actions, etc.).

## Key Features

- **Single complex object**: All secrets are defined in one `config` variable.
- **Pre-encrypted values**: `encryptedValue` must be provided already encrypted with libsodium.
- **Three secret types**: Actions, Codespaces, and Dependabot supported in the same module.
- **Lifecycle protection**: `ignore_changes` on `encrypted_value` to prevent unnecessary drift.
- **Full validation**: Enforces required fields and non-empty values.
- **JSON-native**: Works seamlessly with `terraform.tfvars.json` generated by external programs.

## Basic Usage

### Using `terraform.tfvars.json` (recommended)

```hcl
module "repo_secrets" {
  source = "git::https://github.com/prefapp/tfm.git//modules/github-repository-secrets"

  config = var.config   # Terraform automatically loads terraform.tfvars.json
}

### Inline example

```hcl
module "repo_secrets" {
  source = "git::https://github.com/prefapp/tfm.git//modules/github-repository-secrets"

  config = {
    actions = {
      SECRET_A = {
        secretName     = "SECRET_A"
        repository     = "component_a"
        encryptedValue = "r+RFBGIn8U7z2Opm5RN7PXKdgFzefXiV91IpG3O2DrClZl9dkTJBfhRZbi2uV2nu4ijn5yUfZ9O1eqjaXL2dWByFV+T2swZCQVQdDGmDlF24MPvEFh2ZbQ=="
      }
    }
    codespaces = {}
    dependabot = {}
  }
}
